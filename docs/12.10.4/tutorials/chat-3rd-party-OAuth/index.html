<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Authenticate a user against a 3rd Party OAuth · | Developer&#x27;s Guide</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Overview"/><meta name="docsearch:version" content="12.10.4"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Authenticate a user against a 3rd Party OAuth · | Developer&#x27;s Guide"/><meta property="og:type" content="website"/><meta property="og:url" content="https://Michael-N-M.github.io/botpress-docs/"/><meta property="og:description" content="## Overview"/><meta property="og:image" content="https://Michael-N-M.github.io/botpress-docs/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://Michael-N-M.github.io/botpress-docs/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/botpress-docs/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/hotjar.js"></script><script src="/botpress-docs/js/scrollSpy.js"></script><link rel="stylesheet" href="/botpress-docs/css/main.css"/><script src="/botpress-docs/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/botpress-docs/"><img class="logo" src="/botpress-docs/img/botpress_icon.svg" alt="| Developer&#x27;s Guide"/><h2 class="headerTitleWithLogo">| Developer&#x27;s Guide</h2></a><a href="/botpress-docs/versions"><h3>12.10.4</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/botpress-docs/docs/12.10.4/introduction" target="_self">Docs</a></li><li class=""><a href="https://botpress.com/reference/" target="_self">SDK</a></li><li class=""><a href="https://forum.botpress.com/" target="_self">Community</a></li><li class=""><a href="https://github.com/botpress/botpress" target="_self">Github</a></li><li class=""><a target="_self"></a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Tutorials</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Release Notes<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/releases/migrate">Migrations</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/releases/release-notes">Release Notes</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/releases/v12_10_0">Release Notes - v12.10.0</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Getting Started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/installation">Installation</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/quickstart">Quick Start</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/updating">Updating to New Releases</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/troubleshoot">Troubleshoot</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Main Concepts<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/main/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/main/glossary">Glossary</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/main/content">CMS</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/main/dialog">Dialog Engine</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/main/code">Actions &amp; Hooks</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/main/memory">Memory</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/main/module">Modules</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/main/nlu">NLU</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/main/emulator">Emulator</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Advanced Guides<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/advanced/debug">Debug</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/advanced/configuration">Configurations</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/advanced/authentication">Authentication Methods</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/advanced/i18n">Internationalization</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/advanced/custom-module">Custom Module</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/advanced/performances">Hardware &amp; Performances</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/advanced/hosting">Hosting</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/advanced/versions">Version Control</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/advanced/pipelines">Bot Pipelines</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/advanced/development-pipeline">Development Pipelines</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/advanced/cluster">Clustering</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/advanced/monitoring">Monitoring &amp; Alerting</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Channels<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/channels/web">Website Embedding</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/channels/messenger">Facebook Messenger</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/channels/telegram">Telegram</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/channels/teams">Microsoft Teams</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/channels/converse">Converse API</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/channels/slack">Slack</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/channels/smooch">Smooch (Sunshine Conversations)</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/channels/faq">FAQ</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Tutorials<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/cluster-digital-ocean">Deploying a cluster on Digital Ocean</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/intent-matching">How to act on an intent</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/proactive">Acting Proactively</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/carousel-postback">Using Carousel Postback</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/skill-slot">How to use Slot Skill</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/skill-call-api">How to use Call API</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/external-api">Calling an API in a Custom Action</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/shortlinks">Shortlinks</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/existing-backend">Connecting your bot with your existing backend</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/database">Supported databases</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/timeouts">Timeouts</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/hitl">Human in the loop</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/jump-to">Jump To</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/interbot">Inter-bot Communication / Delegation</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/contextual-faq">Contextual FAQ</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/chat-3rd-party-OAuth">Authenticate a user against a 3rd Party OAuth</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/listen-file-changes">Listening for file changes</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/3rd-party-NLU">Using a 3rd party NLU</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/tutorials/uipath">Using the UiPath integration for Botpress</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Pro Edition<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/pro/about-pro">About</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/pro/licensing">Licensing</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/12.10.4/pro/rbac">Configuring RBAC</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Authenticate a user against a 3rd Party OAuth</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="overview"></a><a href="#overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h2>
<p>Ever wanted to authenticate a user against a 3rd party authentication system to act on its behalf, just like you would do in a mobile/web app? In this tutorial, we will do just that. We will build a simple module that authenticates a user to Twitter and save its credentials to its attributes so it can be used to query its Twitter account.</p>
<blockquote>
<p><strong>Prerequisites:</strong> We assume that you have a knowledge on how to <a href="../advanced/custom-module">create a custom botpress module</a>, that you have a basic knowledge of the <a href="https://botpress.com/reference/">botpress sdk</a> as well as prior experience with <code>botpress.config.json</code>. We also assume that you created a <a href="https://developer.twitter.com/en/docs/basics/getting-started">Twitter app</a> and that you have some previous experience with <a href="http://www.passportjs.org/docs/">Passport.js</a>.</p>
</blockquote>
<p>The code for this example is available in the <a href="https://github.com/botpress/botpress/tree/master/examples/chat-3rd-party-OAuth">examples</a> directory of our GitHub repository.</p>
<h2><a class="anchor" aria-hidden="true" id="register-the-module"></a><a href="#register-the-module" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Register the module</h2>
<p>Botpress modules provide a simple yet powerful way extend your bot capabilities without altering the core features. If we think about our use case here, the only thing that our module has to do is to offer an api so we can perform the steps to authenticate the user to Twitter. No UI, no middlewares, only an api and some configs is required. First of create an <code>src</code> directory with 2 sub dirs <code>backend</code> and <code>views</code>. Then, go ahead and write a simple module entry point (backend/index.ts).</p>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> sdk <span class="hljs-keyword">from</span> <span class="hljs-string">'botpress/sdk'</span>

<span class="hljs-keyword">const</span> onServerStarted = <span class="hljs-keyword">async</span> (bp: <span class="hljs-keyword">typeof</span> sdk) =&gt; {}

<span class="hljs-keyword">const</span> onServerReady = <span class="hljs-keyword">async</span> (bp: <span class="hljs-keyword">typeof</span> sdk) =&gt; {}

<span class="hljs-keyword">const</span> onBotMount = <span class="hljs-keyword">async</span> (bp: <span class="hljs-keyword">typeof</span> sdk, botId: <span class="hljs-built_in">string</span>) =&gt; {}

<span class="hljs-keyword">const</span> entryPoint: sdk.ModuleEntryPoint = {
  onServerStarted,
  onServerReady,
  onBotMount,
  definition: {
    name: <span class="hljs-string">'twitter-auth'</span>,
    fullName: <span class="hljs-string">'Twitter oAuth1 example'</span>,
    homepage: <span class="hljs-string">'https://botpress.com'</span>,
    noInterface: <span class="hljs-literal">true</span>
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> entryPoint
</code></pre>
<p>Now that we have the shell of our module setup, we need to activate it in our <code>botpress.config.json</code> so the botpress module builder can easily find and build it.</p>
<pre><code class="hljs css language-js">{
  <span class="hljs-comment">// MODULES_ROOTS is the modules directory, you can yse your own location</span>
  <span class="hljs-string">"location"</span>: <span class="hljs-string">"MODULES_ROOT/twitter-auth"</span>,
  <span class="hljs-string">"enabled"</span>: <span class="hljs-literal">true</span>
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="module-implementation"></a><a href="#module-implementation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Module implementation</h2>
<p>Now that we have a working module let's get into the implementation. For simplycity we will use Passport.js along with a Twitter Strategy to implement the OAuth flow. Go ahead an install those deps. Once that done, we will need to add our Twitter App api keys so that our bot can properly authenticate the user to Twitter. We acheive this by creating a module config file for each bot. Config here is pretty simple, obviously you can customize it for your needs. Add the following file in the config directory of desired bots:</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// bots/yourbot/config/twitter-auth.json</span>
{
  <span class="hljs-string">"enabled"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">"apiKey"</span>: <span class="hljs-string">"YOUR_TWITTER_APP_API_KEY"</span>
  <span class="hljs-string">"apiSecret"</span>: <span class="hljs-string">"YOUR_TWITTER_APP_SECRET_KEY"</span>
}
</code></pre>
<p>Next step, is to implement the <code>onBotMount</code> function the in our <code>module/src/index.ts</code> that will configure the Passport Twitter straregy for each bot.</p>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">const</span> onBotMount = <span class="hljs-keyword">async</span> (bp: <span class="hljs-keyword">typeof</span> sdk, botId) =&gt; {
  <span class="hljs-keyword">const</span> modConfig = (<span class="hljs-keyword">await</span> bp.config.getModuleConfigForBot(<span class="hljs-string">'twitter-auth'</span>, botId)) <span class="hljs-keyword">as</span> Config
  <span class="hljs-keyword">if</span> (!modConfig.enabled) {
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-comment">// We use process variables that are set on server start from botpress config file, we could use the configs</span>
  <span class="hljs-comment">// const bpConfig = await bp.config.getBotpressConfig()</span>
  <span class="hljs-comment">// const baseCallbackUrl = bpConfig.externalUrl || `http://${bpConfig.host}:${bpConfig.port}`</span>
  <span class="hljs-keyword">const</span> baseCallbackUrl = process.EXTERNAL_URL || <span class="hljs-string">`http://<span class="hljs-subst">${process.HOST}</span>:<span class="hljs-subst">${process.PORT}</span>`</span>

  passport.use(
    <span class="hljs-keyword">new</span> TwitterStrategy(
      {
        consumerKey: modConfig.apiKey,
        consumerSecret: modConfig.apiSecret,
        callbackUrl: <span class="hljs-string">`<span class="hljs-subst">${baseCallbackUrl}</span>/api/v1/bots/<span class="hljs-subst">${botId}</span>/mod/twitter-auth/callback`</span>
      },
      <span class="hljs-function">(<span class="hljs-params">token: <span class="hljs-built_in">string</span>, tokenSecret: <span class="hljs-built_in">string</span>, profile: <span class="hljs-built_in">any</span>, done: <span class="hljs-built_in">Function</span></span>) =&gt;</span> {
        done(<span class="hljs-literal">undefined</span>, { token, tokenSecret, profile })
      }
    )
  )
}
</code></pre>
<p>Now it you try to run botpress, you will have an error because the Passport Twitter Strategy needs a server session which is disabled by default, enable it in your botpress config : set <code>httpServer.session.enabled</code> to <code>true</code>. If you start the server again, botpress should be running properly. Great, now notice that we need point Twitter to a callbackUrl so it can provide the authentication values. Let's implement that callback url for the bot in particular, thankfully botpress http sdk offers <code>createRouterForBot</code> that allows us to define a custom module router for a specific bot. We will define our router in the <code>onServerReady</code> function of our module entry point.</p>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">const</span> onServerReady = <span class="hljs-keyword">async</span> (bp: <span class="hljs-keyword">typeof</span> sdk) =&gt; {
  <span class="hljs-keyword">const</span> router = bp.http.createRouterForBot(<span class="hljs-string">'twitter-auth'</span>, { checkAuthentication: <span class="hljs-literal">false</span> }) <span class="hljs-keyword">as</span> Router

  router.get(<span class="hljs-string">'/callback'</span>, <span class="hljs-keyword">async</span> (req: ReqWithSession, res) =&gt; {
    passport.authenticate(<span class="hljs-string">'twitter'</span>, {}, <span class="hljs-keyword">async</span> (err, twitterUserDat) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-comment">/*
          Twitter authentication error
          Your Error handling code goes here
         */</span>
        res.redirect(<span class="hljs-string">'/'</span>)
      }

      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> bp.users.updateAttributes(req.session.channel, req.session.userId, { twitter: twitterUserDat })
        <span class="hljs-comment">// This will simply close the authentication window</span>
        res.send(<span class="hljs-string">'&lt;div&gt;Twitter auth success!&lt;/div&gt;&lt;script&gt;window.setTimeout(window.close, 1500)&lt;/script&gt;'</span>)
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-comment">/*
          Update user attributes error
          Your Error handling code goes here
         */</span>
        res.redirect(<span class="hljs-string">'/CUSTOM_AUTH_ERROR_ROUTE'</span>)
      }
    })(req, res)
  })
}
</code></pre>
<p>The only step missing is to find a way to send the user to Twitter Authentication. We will simply define a route in our router in which we call passport to initiate the authentication flow. The following route in custom router does the trick.</p>
<pre><code class="hljs css language-ts">router.get(<span class="hljs-string">'/auth'</span>, <span class="hljs-keyword">async</span> (req: ReqWithSession, res) =&gt; {
  req.session.channel = req.query.channel
  req.session.userId = req.query.userId

  passport.authenticate(<span class="hljs-string">'twitter'</span>)(req, res)
})
</code></pre>
<p>That's it you can now use read Twitter Authentication properties in the users's attributes. Depending on your business logic, when a user needs to be authenticated to Twitter, you now simply have to check if the <code>twitter</code> property set in the users attributes. If it's not set then you need to suggest to your user to to authenticate to Twitter, you could for instance display a builtin card element with <code>OpenUrl</code> as action with our authentication route as url value : <code>http://yourbot.host/api/v1/bots/${botId}/mod/twitter-auth/auth?channel=${chanelId}&amp;userId=${userId}</code>. Notice that we pass <code>channel</code> &amp; <code>userId</code> as query params so we can set it in the user's session, it'll be used to find the user when our callback route is called by Twitter.</p>
<blockquote>
<p><strong>Pro tip:</strong> Define a <a href="/docs/tutorials/shortlinks">shortlink</a> for our auth bot module route to make it easy to use on your flow or content.</p>
</blockquote>
<p>That's about it. As a quick recap, in this tutorial, we built a very simple module with no interface from scratch that allows a Twitter OAuth flow in a chat session. Of course you could (and should) extend this module for your own needs. The simplicity of this implementation shows that the same concepts can be applied to other Auth Providers. You could even combine different Authentication Providers so you can perform different actions on the authenticated user's behalf for instance book a Uber Ride and share it to twitter (not that this is a useful usecase). Full code example is available on <a href="https://github.com/botpress/botpress/tree/master/examples/chat-3rd-party-OAuth">GitHub</a>.</p>
<p>Enjoy extending Botpress.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/botpress-docs/docs/12.10.4/tutorials/contextual-faq"><span class="arrow-prev">← </span><span>Contextual FAQ</span></a><a class="docs-next button" href="/botpress-docs/docs/12.10.4/tutorials/listen-file-changes"><span>Listening for file changes</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#overview">Overview</a></li><li><a href="#register-the-module">Register the module</a></li><li><a href="#module-implementation">Module implementation</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><div><h5>Docs</h5><a href="/botpress-docs/docs/introduction">Getting Started</a><a href="https://botpress.com/reference/">API Reference</a></div><div><h5>Community</h5><a href="https://forum.botpress.com/" target="_blank" rel="noreferrer noopener">forum.botpress.com</a><a href="https://stackoverflow.com/search?q=botpress" target="_blank" rel="noreferrer noopener">Stack Overflow</a></div><div><h5>More</h5><a href="https://github.com/botpress">GitHub</a><a class="github-button" href="https://github.com/botpress/botpress" data-icon="octicon-star" data-count-href="/botpress/botpress/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a><a href="https://twitter.com/getbotpress">Twitter</a></div></section><a href="https://botpress.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/botpress-docs/img/botpress.svg" alt="Botpress, Inc." width="170" height="45"/></a><section class="copyright">Copyright © 2020 Botpress, Inc.</section></footer></div></body></html>
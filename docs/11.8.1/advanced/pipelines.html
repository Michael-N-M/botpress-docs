<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Bot Pipeline · | Developer&#x27;s Guide</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Overview"/><meta name="docsearch:version" content="11.8.1"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Bot Pipeline · | Developer&#x27;s Guide"/><meta property="og:type" content="website"/><meta property="og:url" content="https://Michael-N-M.github.io/botpress-docs/"/><meta property="og:description" content="## Overview"/><meta property="og:image" content="https://Michael-N-M.github.io/botpress-docs/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://Michael-N-M.github.io/botpress-docs/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/botpress-docs/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/hotjar.js"></script><script src="/botpress-docs/js/scrollSpy.js"></script><link rel="stylesheet" href="/botpress-docs/css/main.css"/><script src="/botpress-docs/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/botpress-docs/"><img class="logo" src="/botpress-docs/img/botpress_icon.svg" alt="| Developer&#x27;s Guide"/><h2 class="headerTitleWithLogo">| Developer&#x27;s Guide</h2></a><a href="/botpress-docs/versions"><h3>11.8.1</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/botpress-docs/docs/11.8.1/introduction" target="_self">Docs</a></li><li class=""><a href="https://botpress.com/reference/" target="_self">SDK</a></li><li class=""><a href="https://forum.botpress.com/" target="_self">Community</a></li><li class=""><a href="https://github.com/botpress/botpress" target="_self">Github</a></li><li class=""><a target="_self"></a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Version Management</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Getting Started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/installation">Installation</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/quickstart">Quick Start</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/updating">Updating to New Releases</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/troubleshoot">Troubleshoot</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Main Concepts<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/main/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/main/content">CMS</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/main/dialog">Dialog Engine</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/main/code">Actions &amp; Hooks</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/main/memory">Memory</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/main/module">Modules</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/main/nlu">NLU</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/main/emulator">Emulator</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Advanced Concepts<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/advanced/configuration">Configuration</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/advanced/debug">Debugging</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/advanced/custom-module">Custom Module</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/advanced/analytics">Custom Analytics</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/advanced/authentication">Authentication</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/advanced/performances">Hardware &amp; Performances</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Version Management</h4><ul><li class="navListItem navListItemActive"><a class="navItem" href="/botpress-docs/docs/11.8.1/advanced/pipelines">Bot Pipeline</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/advanced/versions">Version control</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Hosting &amp; High Availability</h4><ul><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/advanced/architecture">Architecture Overview</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/advanced/hosting">Hosting &amp; Environment</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/advanced/cluster">Server Cluster</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/advanced/monitoring">Monitoring &amp; Alerting</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Channels<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/channels/web">Website Embedding</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/channels/messenger">Facebook Messenger</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/channels/telegram">Telegram</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/channels/converse">Converse API</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/channels/faq">FAQ</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Tutorials<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/tutorials/existing-backend">Connecting your bot with your existing backend</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/tutorials/database">Supported databases</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/tutorials/hitl">Human in the loop</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/tutorials/jump-to">Jump To</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/tutorials/proactive">Acting Proactively</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/tutorials/interbot">Inter-bot Communication / Delegation</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/tutorials/shortlinks">Shortlinks</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/tutorials/timeouts">Timeouts</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/tutorials/i18n">Internationalization (i18n)</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/tutorials/external-api">Calling an API in a Custom Action</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/tutorials/chat-3rd-party-OAuth">Authenticate a user against a 3rd Party OAuth</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/tutorials/contextual-faq">Contextual FAQ</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/tutorials/listen-file-changes">Listening for file changes</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Pro Edition<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/pro/about-pro">About</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/pro/licensing">Licensing</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Release Notes<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/releases/release-notes">Release Notes</a></li><li class="navListItem"><a class="navItem" href="/botpress-docs/docs/11.8.1/releases/migrate">Migrations</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Bot Pipeline</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="overview"></a><a href="#overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h2>
<p>Bot pipelines are built on top of the multi-bot capability of Botpress. They allow teams to work on bots with multiple <strong>stages</strong> the same way others would work on software products. Different versions of a bot can run and co-exist on different stages. In software development, each team has its own way of working with pipelines and reacting to events along the pipeline, Botpress pipelines let you do the same.</p>
<p>Although a typical pipeline would have 3 stages (e.g: <em>Development</em>, <em>Staging</em> and <em>Production</em>) where a bot goes through all of them. Botpress lets you define your own stages and customize how they interact.</p>
<h2><a class="anchor" aria-hidden="true" id="prerequisite"></a><a href="#prerequisite" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisite</h2>
<p>Pipelines is a Botpress pro feature, so make you're running pro with a valid license key. If you don't have a license key or don't know how activate it, please follow <a href="/docs/pro/licensing">this guide</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="concepts"></a><a href="#concepts" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Concepts</h2>
<h3><a class="anchor" aria-hidden="true" id="stage"></a><a href="#stage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Stage</h3>
<p>As stated above, a Pipeline is simply a list of stages a bot needs to (or can) go through. A stage is defined as a simple json :</p>
<pre><code class="hljs css language-json">{
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"dev"</span>,
  <span class="hljs-attr">"label"</span>: <span class="hljs-string">"Development"</span>,
  <span class="hljs-attr">"action"</span>: <span class="hljs-string">"promote_copy"</span>
}
</code></pre>
<p>Properties are self explanatory except action which is defined. In a pipeline definition, the order of stages is defined by the order it appears in the array <code>(1st stage === idx 0)</code></p>
<h3><a class="anchor" aria-hidden="true" id="stage-actions"></a><a href="#stage-actions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Stage Actions</h3>
<p>A stage action defines how the pipeline system behaves when a bot is set for promotion (i.e go from one stage to another). Currently 2 actions are available <code>promote_move</code> which simply moves the bot from current to next stage and <code>promote_copy</code> which creates an exact copy of the bot before being promoted to next stage. The latter is useful when you want keep a work in progress (i.e Dev stage) version of your bot and send versions along the pipeline.</p>
<h3><a class="anchor" aria-hidden="true" id="bot-pipeline-status"></a><a href="#bot-pipeline-status" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bot Pipeline Status</h3>
<p>Each bot now defines a <code>pipeline_status</code> object in its <code>bot.config.json</code> file. The object structure goes as follows :</p>
<pre><code class="hljs css language-js">{
  <span class="hljs-comment">/*
    ... other bot config fields
  */</span>
  <span class="hljs-string">"pipeline_status"</span>: {
    <span class="hljs-string">"current_stage"</span>: {
      <span class="hljs-string">"id"</span>: <span class="hljs-string">"dev"</span>, <span class="hljs-comment">// id of the current stage</span>
      <span class="hljs-string">"promoted_on"</span>: <span class="hljs-string">"2019-04-03T01:08:46.999Z"</span>, <span class="hljs-comment">// date the bot has moved to this stage</span>
      <span class="hljs-string">"promoted_by"</span>: <span class="hljs-string">"user@botpress.com"</span> <span class="hljs-comment">//email of the user who changed the stage of the bot</span>
    },
    <span class="hljs-string">"stage_request"</span>: {
      <span class="hljs-string">"id"</span>: <span class="hljs-string">"staging"</span>, <span class="hljs-comment">//id of the desired stage</span>
      <span class="hljs-string">"requested_on"</span>: <span class="hljs-string">"2019-04-04T13:16:32.107Z"</span>,
      <span class="hljs-string">"requested_by"</span>: <span class="hljs-string">"user2@botpress.com"</span> <span class="hljs-comment">//email of the user who asked for a stage change</span>
    }
  }
}
</code></pre>
<p>At the moment, only the current_stage will be interesting for you. We will learn more on <code>stage_request</code> in the <a href="#available-hooks">available hooks section</a></p>
<h2><a class="anchor" aria-hidden="true" id="usage"></a><a href="#usage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Usage</h2>
<p>If you tried Botpress, you've already been using the Pipeline feature, you just don't know it. By default, every Botpress deployment defines a single stage pipeline, even running on the community edition. In the next sections we will show how to use different pipeline components and build a standard <strong>Dev</strong> ==&gt; <strong>Staging</strong> ==&gt; <strong>Prod</strong>.</p>
<h3><a class="anchor" aria-hidden="true" id="configuration"></a><a href="#configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h3>
<p>To define your pipeline, open the <code>workspaces.json</code> file and edit the pipeline property.</p>
<pre><code class="hljs css language-js">{
  <span class="hljs-comment">/*
  ...other workspace property
  */</span>
  <span class="hljs-string">"pipeline"</span> : [
    {
      <span class="hljs-string">"id"</span>: <span class="hljs-string">"dev"</span>,
      <span class="hljs-string">"label"</span>: <span class="hljs-string">"Development"</span>,
      <span class="hljs-string">"action"</span>: <span class="hljs-string">"promote_copy"</span>
    },
    {
      <span class="hljs-string">"id"</span>: <span class="hljs-string">"staging"</span>,
      <span class="hljs-string">"label"</span>: <span class="hljs-string">"Staging"</span>,
      <span class="hljs-string">"action"</span>: <span class="hljs-string">"promote_move"</span> <span class="hljs-comment">//for demonstration purposes</span>
    },
    {
      <span class="hljs-string">"id"</span>: <span class="hljs-string">"prod"</span>,
      <span class="hljs-string">"label"</span>: <span class="hljs-string">"Production"</span>,
      <span class="hljs-string">"action"</span>: <span class="hljs-string">"noop"</span>
    }
  ]
}
</code></pre>
<p>This simple configuration will activate the pipeline feature.</p>
<blockquote>
<p><strong>Note</strong>: Botpress allows pipelines of maximum 4 stages, more than this will result in a suboptimal usage of Botpress.</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="graphical-interface"></a><a href="#graphical-interface" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Graphical Interface</h3>
<p>After defining your pipeline, restart your server and open your admin panel and create a bot. You should then see a pipeline like the following :</p>
<p><img src="/botpress-docs/docs/assets/pipeline.png" alt="Pipeline">
Go ahead an pick the <code>promote to next stage</code> action. You'll see a <strong>copy</strong> of the bot appear in the Staging environment. (<code>promote_copy</code> in the stage definition)
<img src="/botpress-docs/docs/assets/pipeline_promote.png" alt="Pipeline Promote">
<img src="/botpress-docs/docs/assets/pipeline_promoted_copy.png" alt="Pipeline Promote copy">
This time, pick the same action on the Staging bot, you'll notice the bot will <strong>move</strong> to Production. (<code>promote_move</code> in the stage definition)
<img src="/botpress-docs/docs/assets/pipeline_promoted_move.png" alt="Pipeline Promote move"></p>
<p>Want to lock a bot in a particular stage or change it's name along the pipeline ? You can do so using <a href="#available-hooks">available hooks</a></p>
<h3><a class="anchor" aria-hidden="true" id="api"></a><a href="#api" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API</h3>
<p>Behind the scene, the UI simply makes an authenticated call to the admin api. If you want to promote a bot by api you can easily do so</p>
<pre><code class="hljs css language-bash">curl -X POST http://your.botpress.deployment/api/v1/admin/bots/{_YOUR_BOT_ID_}/stage -H=<span class="hljs-string">"Authorization:Bearer {_YOUR_AUTH_TOKEN_}"</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="available-hooks"></a><a href="#available-hooks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Available Hooks</h3>
<p>Hooks are key components to fully customize the pipeline feature to your needs. If you don't know about hooks, go read <a href="../main/code#hooks">the docs</a> right away.
Until now, we didn't customize anything of the pipeline feature and we didn't use or even see the <code>stage_request</code> property in the bot configs. Say that we want to check if the user has the right to change the stage of the bot, then rename it, give it custom id and lock it. For this we would use the <code>on_stage_request</code> hook.</p>
<p>The hook will be called with the following arguments: <strong>bp</strong> (botpress sdk), <strong>bot</strong> (content of bot.config.json) , <strong>users</strong> (users in the workspace), <strong>pipeline</strong> (your pipeline definition), <strong>hookResult</strong> (object with a <code>actions</code> property).</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">//function (bp, bot, users, pipeline, hookResult) {</span>
<span class="hljs-keyword">const</span> request_user = users.find(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.email == bot.pipeline_status.stage_request.requested_by)
<span class="hljs-keyword">if</span> (!request_user || request_user.role !== <span class="hljs-string">'YOUR_TARGET_ROLE'</span>) {
  <span class="hljs-comment">/*
  we want to keep the bot in the current stage and until another user with the right role promotes it
  here would go an api call to your 3rd party notification service
  */</span>
  hookResult.actions = []
  <span class="hljs-keyword">return</span>
}

<span class="hljs-comment">/*
hookResult contains the action in the stage definition by default, the promoted bot (copied or moved) will have the following properties
*/</span>
bot.name = <span class="hljs-string">'new bot name'</span>
bot.id = <span class="hljs-string">'new-bot-id='</span>
bot.locked = <span class="hljs-literal">true</span>
<span class="hljs-comment">// }</span>
</code></pre>
<p>That's it. Now what if we want to call some 3rd party email service to notify all workspace users once a bot has changed stage? There's a hook for that: <code>after_stage_changed</code>.</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">//function (bp, previousBotConfig, bot, users, pipeline) {</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">from</span> = previousBotConfig.pipeline_status.current_stage.label
<span class="hljs-keyword">const</span> to = bot.pipeline_status.current_stage.label

<span class="hljs-built_in">Promise</span>.all(
  users.map(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> axios.post(<span class="hljs-string">'/your-email-service-api'</span>, {
      <span class="hljs-attr">toEmail</span>: u.email
      <span class="hljs-attr">message</span>: <span class="hljs-string">`bot: <span class="hljs-subst">${previousBotConfig.id}</span> went from stage <span class="hljs-subst">${<span class="hljs-keyword">from</span>}</span> to <span class="hljs-subst">${to}</span>`</span>
    })
  })
).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  <span class="hljs-comment">//done</span>
})
<span class="hljs-comment">//}</span>
</code></pre>
<p>For another example, see pre-built hooks in your global/hooks folder.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/botpress-docs/docs/11.8.1/advanced/performances"><span class="arrow-prev">← </span><span>Performances</span></a><a class="docs-next button" href="/botpress-docs/docs/11.8.1/advanced/versions"><span>Version Control</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#overview">Overview</a></li><li><a href="#prerequisite">Prerequisite</a></li><li><a href="#concepts">Concepts</a><ul class="toc-headings"><li><a href="#stage">Stage</a></li><li><a href="#stage-actions">Stage Actions</a></li><li><a href="#bot-pipeline-status">Bot Pipeline Status</a></li></ul></li><li><a href="#usage">Usage</a><ul class="toc-headings"><li><a href="#configuration">Configuration</a></li><li><a href="#graphical-interface">Graphical Interface</a></li><li><a href="#api">API</a></li><li><a href="#available-hooks">Available Hooks</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><div><h5>Docs</h5><a href="/botpress-docs/docs/introduction">Getting Started</a><a href="https://botpress.com/reference/">API Reference</a></div><div><h5>Community</h5><a href="https://forum.botpress.com/" target="_blank" rel="noreferrer noopener">forum.botpress.com</a><a href="https://stackoverflow.com/search?q=botpress" target="_blank" rel="noreferrer noopener">Stack Overflow</a></div><div><h5>More</h5><a href="https://github.com/botpress">GitHub</a><a class="github-button" href="https://github.com/botpress/botpress" data-icon="octicon-star" data-count-href="/botpress/botpress/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a><a href="https://twitter.com/getbotpress">Twitter</a></div></section><a href="https://botpress.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/botpress-docs/img/botpress.svg" alt="Botpress, Inc." width="170" height="45"/></a><section class="copyright">Copyright © 2020 Botpress, Inc.</section></footer></div></body></html>